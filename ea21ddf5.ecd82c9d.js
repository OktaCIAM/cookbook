(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{88:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return a})),n.d(t,"metadata",(function(){return r})),n.d(t,"toc",(function(){return c})),n.d(t,"default",(function(){return p}));var o=n(3),i=n(7),s=(n(0),n(91)),a={id:"max-session-timeout",title:"Max Session Timeout",sidebar_label:"Max Session Timeout",slug:"/max-session-timeout",description:"For an application developer who want to force a sign out or terminate a session after a set number of hours regardless of activity within Okta.",keywords:["Okta CIAM","Maximum Session Timeout","Okta Sessions Management","Okta Timeouts","Session Timeouts","Session Management"]},r={unversionedId:"sessions/max-session-timeout",id:"sessions/max-session-timeout",isDocsHomePage:!1,title:"Max Session Timeout",description:"For an application developer who want to force a sign out or terminate a session after a set number of hours regardless of activity within Okta.",source:"@site/docs/sessions/maxium-session-timeout.md",slug:"/max-session-timeout",permalink:"/docs/max-session-timeout",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/sessions/maxium-session-timeout.md",version:"current",sidebar_label:"Max Session Timeout",sidebar:"docs",previous:{title:"Get Current MAUs (Monthly Active Users)",permalink:"/docs/get-current-monthly-active-users"},next:{title:"Intercept External IdP Tokens",permalink:"/docs/intercept-external-idp-tokens"}},c=[{value:"Problem",id:"problem",children:[]},{value:"Solution",id:"solution",children:[{value:"Overview",id:"overview",children:[]},{value:"Node.js Script",id:"nodejs-script",children:[]}]},{value:"Discussion",id:"discussion",children:[]},{value:"Credits",id:"credits",children:[]}],l={toc:c};function p(e){var t=e.components,n=Object(i.a)(e,["components"]);return Object(s.b)("wrapper",Object(o.a)({},l,n,{components:t,mdxType:"MDXLayout"}),Object(s.b)("h2",{id:"problem"},"Problem"),Object(s.b)("p",null,"An application developer may want to force a sign out or terminate a session after ",Object(s.b)("inlineCode",{parentName:"p"},"N")," hours regardless of activity. This is known as ",Object(s.b)("strong",{parentName:"p"},"Maximum Session Timeout")," and is common for applications with particular session rules. However, the Okta dashboard only provides a configuration for ",Object(s.b)("strong",{parentName:"p"},"Maximum Idle Session Timeout")," as shown below."),Object(s.b)("p",null,Object(s.b)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/6020066/124000085-39f12880-d9a1-11eb-9d11-ac4205f44d5a.png",alt:"Session Expire After"})),Object(s.b)("h2",{id:"solution"},"Solution"),Object(s.b)("p",null,"While Okta does not support this setting within the admin dashboard, this can be configured through the ",Object(s.b)("a",{parentName:"p",href:"https://developer.okta.com/docs/reference/api/policy/"},"Policy APIs"),". The documentation for this setting can be found on the ",Object(s.b)("a",{parentName:"p",href:"https://developer.okta.com/docs/reference/api/policy/#signon-session-object"},"Sign On Session Object"),"."),Object(s.b)("h3",{id:"overview"},"Overview"),Object(s.b)("p",null,"With the APIs create a policy to contain a rule with an ",Object(s.b)("inlineCode",{parentName:"p"},"actions.signon.session.maxSessionLifetimeMinutes")," configured."),Object(s.b)("p",null,Object(s.b)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/6020066/124000488-9fddb000-d9a1-11eb-9221-9912f666ed87.png",alt:"Dashboard Example"})),Object(s.b)("p",null,"The API sequence is as followed:"),Object(s.b)("blockquote",null,Object(s.b)("p",{parentName:"blockquote"},Object(s.b)("strong",{parentName:"p"},"Create Policy")," > ",Object(s.b)("strong",{parentName:"p"},"Create Rule")," > ",Object(s.b)("strong",{parentName:"p"},"Update Rule with maxSessionLifeTime"))),Object(s.b)("p",null,Object(s.b)("strong",{parentName:"p"},"Create Policy")),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-bash"},'curl -v -X PUT \\\n-H "Accept: application/json" \\\n-H "Content-Type: application/json" \\\n-H "Authorization: SSWS {api_token}" \\\n-d \'{\n    "type": "OKTA_SIGN_ON",\n    "name": "Session Policy",\n}\' "https://${yourOktaDomain}/api/v1/policies"\n')),Object(s.b)("p",null,Object(s.b)("strong",{parentName:"p"},"Create Rule for Policy with Max Session Timeout")),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-bash"},'curl -v -X POST \\\n-H "Accept: application/json" \\\n-H "Content-Type: application/json" \\\n-H "Authorization: SSWS ${api_token}" \\\n-d \'{\n  "type": "SIGN_ON",\n  "name": "Max Session Lifetime",\n  "actions": {\n    "signon": {\n      "access": "ALLOW",\n       "session": {\n          "maxSessionLifetimeMinutes": 240, # Set desired Max Session Lifetime\n          "usePersistentCookie": false,\n          "maxSessionIdleMinutes": 120\n       }\n    }\n  }\n}\' "https://${yourOktaDomain}/api/v1/policies/{policyId}/rules"\n')),Object(s.b)("hr",null),Object(s.b)("p",null,"In addition, it's worth noting that the admin dashboard can be used to create the policy and rule followed with a ",Object(s.b)("inlineCode",{parentName:"p"},"PUT")," request to update the rule with the ",Object(s.b)("inlineCode",{parentName:"p"},"maxSessionLifetimeMinutes"),"."),Object(s.b)("p",null,"This approach requires a few additional steps to get the associated IDs:"),Object(s.b)("blockquote",null,Object(s.b)("p",{parentName:"blockquote"},Object(s.b)("strong",{parentName:"p"},"Get Policy ID with ",Object(s.b)("a",{parentName:"strong",href:"https://developer.okta.com/docs/reference/api/policy/#get-all-policies-by-type"},'"Get all Policies by type"'))," > ",Object(s.b)("strong",{parentName:"p"},"Get Rule Id with ",Object(s.b)("a",{parentName:"strong",href:"https://developer.okta.com/docs/reference/api/policy/#get-policy-rules"},'"Get Policy Rules"')))),Object(s.b)("p",null,Object(s.b)("strong",{parentName:"p"},"Update Existing Rule with Max Session Lifetime")),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-bash"},'curl -v -X PUT \\\n-H "Accept: application/json" \\\n-H "Content-Type: application/json" \\\n-H "Authorization: SSWS {api_token}" \\\n-d \'{\n    "type": "SIGN_ON",\n    "name": "Max Session Lifetime",\n    "actions": {\n        "signon": {\n            "access": "ALLOW",\n            "session": {\n                "maxSessionLifetimeMinutes": 240, # Desired Life Time\n                "usePersistentCookie": false,\n                "maxSessionIdleMinutes": 120\n            }\n        }\n    }\n}\' "https://${yourOktaDomain}/api/v1/policies/${policyId}/rules/${ruleId}"\n')),Object(s.b)("h3",{id:"nodejs-script"},"Node.js Script"),Object(s.b)("p",null,"The  working code sample below can be used for reference or as a script."),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-js"},'const okta = require(\'@okta/okta-sdk-nodejs\');\n\n// Configure\nconst API_KEY = \'API_KEY_HERE\';\nconst OKTA_ORG_URL = \'https://your-okta-org.okta.com\';\n\n// Configure Policy / Rule Settings\nconst MAX_LIFETIME_MINUTES = 240;\n\nconst USE_PERSISTENT_COOKIE = false;\nconst MAX_SESSION_IDLE_MINUTES = 120;\nconst POLICY_NAME = \'Max Session Timeout\';\nconst POLICY_DESCRIPTION = \'Policy for Session Management\';\nconst RULE_NAME = \'Max Session Timeout\'\n\nconst client = new okta.Client({\n  orgUrl: OKTA_ORG_URL,\n  token: API_KEY\n});\n\nconst createMaxSessionTimeoutPolicy = async () => {\n  try {\n      const policy = await client.createPolicy({\n        type: "OKTA_SIGN_ON",\n        name: POLICY_NAME,\n        description: POLICY_DESCRIPTION\n      });\n\n      const rule = await policy.createRule({\n        "type": "SIGN_ON",\n        "name": RULE_NAME,\n        "actions": {\n          "signon": {\n            "access": "ALLOW",\n            "session": {\n              "maxSessionLifetimeMinutes": MAX_LIFETIME_MINUTES,\n              "usePersistentCookie": USE_PERSISTENT_COOKIE,\n              "maxSessionIdleMinutes": MAX_SESSION_IDLE_MINUTES\n            }\n          }\n        }\n      });\n\n      if (rule) {\n        console.log(`\n-- Script Successful --\nPolicy: ${POLICY_NAME} (${policy.id})\nRule: ${rule.name} (${rule.id})\nMax Session Lifetime: ${rule.actions.signon.session.maxSessionLifetimeMinutes} Minutes`)\n      }\n  } catch (err) {\n    console.log(`\n-- Script failed --\nReason: ${err}`)\n  }\n}\n\ncreateMaxSessionTimeoutPolicy();\n')),Object(s.b)("h4",{id:"try-it-yourself"},"Try it yourself"),Object(s.b)("p",null,"You can use the REPL below to execute the script without the need of setting up any additional environments or tools, simply update the environment variables and configure the settings."),Object(s.b)("iframe",{frameborder:"0",width:"100%",height:"500px",src:"https://repl.it/@brh55/max-session-timeout-okta?lite=true"}),Object(s.b)("h2",{id:"discussion"},"Discussion"),Object(s.b)("p",null,"When setting the rule the ",Object(s.b)("inlineCode",{parentName:"p"},"maxSessionLifetimeMinutes"),", Okta expects the ",Object(s.b)("inlineCode",{parentName:"p"},"maxSessionIdleMinutes")," to be set to equal or lesser than the sessionlifetime minutes."),Object(s.b)("h2",{id:"credits"},"Credits"),Object(s.b)("p",null,"Credit to Sudipto Desmukh for providing this solution, his original write up can be found on his ",Object(s.b)("a",{parentName:"p",href:"http://ptotech.blogspot.com/2018/03/sudipto-desmukh-set-maximum-session-timeout.html?m=1"},"blog")," and ",Object(s.b)("a",{parentName:"p",href:"https://github.com/brh55"},"Brandon Him")," for the write-up and sample script."))}p.isMDXComponent=!0},91:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return d}));var o=n(0),i=n.n(o);function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,o,i=function(e,t){if(null==e)return{};var n,o,i={},s=Object.keys(e);for(o=0;o<s.length;o++)n=s[o],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(o=0;o<s.length;o++)n=s[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=i.a.createContext({}),p=function(e){var t=i.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},u=function(e){var t=p(e.components);return i.a.createElement(l.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return i.a.createElement(i.a.Fragment,{},t)}},m=i.a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,s=e.originalType,a=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),u=p(n),m=o,d=u["".concat(a,".").concat(m)]||u[m]||b[m]||s;return n?i.a.createElement(d,r(r({ref:t},l),{},{components:n})):i.a.createElement(d,r({ref:t},l))}));function d(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var s=n.length,a=new Array(s);a[0]=m;var r={};for(var c in t)hasOwnProperty.call(t,c)&&(r[c]=t[c]);r.originalType=e,r.mdxType="string"==typeof e?e:o,a[1]=r;for(var l=2;l<s;l++)a[l]=n[l];return i.a.createElement.apply(null,a)}return i.a.createElement.apply(null,n)}m.displayName="MDXCreateElement"}}]);