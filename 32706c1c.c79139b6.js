(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{76:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return i})),n.d(t,"metadata",(function(){return s})),n.d(t,"toc",(function(){return l})),n.d(t,"default",(function(){return p}));var o=n(3),r=n(7),a=(n(0),n(90)),i={id:"get-token-with-existing-session",title:"Get Tokens for Logged in User",sidebar_label:"Get Tokens for Logged In User",slug:"/get-tokens-for-logged-in-user-with-okta",description:"How to get tokens with an already logged in user through Okta.",keywords:["Okta CIAM","Okta Access Tokens","Okta Session Management","Okta Token Management","Session Token Exchange","Session Already Exists","SSO Okta"]},s={unversionedId:"tokens/get-token-with-existing-session",id:"tokens/get-token-with-existing-session",isDocsHomePage:!1,title:"Get Tokens for Logged in User",description:"How to get tokens with an already logged in user through Okta.",source:"@site/docs/tokens/get-tokens-with-logged-in-user.md",slug:"/get-tokens-for-logged-in-user-with-okta",permalink:"/docs/get-tokens-for-logged-in-user-with-okta",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/tokens/get-tokens-with-logged-in-user.md",version:"current",sidebar_label:"Get Tokens for Logged In User",sidebar:"docs",previous:{title:"Intercept External IdP Tokens",permalink:"/docs/intercept-external-idp-tokens"}},l=[{value:"Problem",id:"problem",children:[]},{value:"Solution",id:"solution",children:[]},{value:"Discussion",id:"discussion",children:[{value:"Related Links",id:"related-links",children:[]}]}],c={toc:l};function p(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(a.b)("wrapper",Object(o.a)({},c,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)("h2",{id:"problem"},"Problem"),Object(a.b)("p",null,"The user may already have an existing session with Okta (through another application or dashboard), however, your application may not have references to the oAuth/OIDC tokens OR the ",Object(a.b)("a",{parentName:"p",href:"https://devforum.okta.com/t/getting-a-fresh-jwt-on-demand/14686"},"token's claim do not reflect recently updated attributes"),"."),Object(a.b)("h2",{id:"solution"},"Solution"),Object(a.b)("p",null,"Okta provides the ability to ",Object(a.b)("a",{parentName:"p",href:"https://developer.okta.com/docs/reference/api/oidc/#parameter-details"},"silently authenticate an existing user")," during a browser-based OpenID Connect flow with the ",Object(a.b)("inlineCode",{parentName:"p"},"prompt")," parameter set to ",Object(a.b)("inlineCode",{parentName:"p"},"none"),"."),Object(a.b)("p",null,"The steps are as followed:"),Object(a.b)("ol",null,Object(a.b)("li",{parentName:"ol"},Object(a.b)("em",{parentName:"li"},"Recommended (Same Domains): ",Object(a.b)("a",{parentName:"em",href:"https://developer.okta.com/docs/reference/api/sessions/#get-current-session"},"Validate Existing Session"))),Object(a.b)("li",{parentName:"ol"},"Perform PKCE OAuth flow by redirecting user to your tenant's ",Object(a.b)("a",{parentName:"li",href:"https://developer.okta.com/docs/reference/api/oidc/#authorize"},Object(a.b)("inlineCode",{parentName:"a"},"/authorize")," endpoint")," with ",Object(a.b)("inlineCode",{parentName:"li"},"prompt=none")," with a ",Object(a.b)("inlineCode",{parentName:"li"},"response_mode=query")),Object(a.b)("li",{parentName:"ol"},"Parse code from the ",Object(a.b)("inlineCode",{parentName:"li"},"callback")," redirect and exchange code for tokens"),Object(a.b)("li",{parentName:"ol"},"Store new tokens in the application")),Object(a.b)("p",null,"Note, the redirect can create a jaggered user experience, but this can be improved upon with the use of an hidden iFrame. However, there is an important caveat one must consider prior to going with this approach:"),Object(a.b)("blockquote",null,Object(a.b)("p",{parentName:"blockquote"},"\u26a0\ufe0f  Cross-site origin iFrames are loaded in a third-party context. As a result, some browsers -- and eventually all -- block third-party cookies by default, therefore, this solution will not work for some environments. For more details, please refer to the ",Object(a.b)("a",{parentName:"p",href:"https://support.okta.com/help/s/article/FAQ-How-Blocking-Third-Party-Cookies-Can-Potentially-Impact-Your-Okta-Environment?language=en_US"},"support page"),".")),Object(a.b)("p",null,"If this caveat doesn't apply to your environment, the ",Object(a.b)("inlineCode",{parentName:"p"},"okta-auth-js")," SDK provides a method, ",Object(a.b)("inlineCode",{parentName:"p"},"token.getWithoutPrompt(options)"),", all within a hidden iFrame."),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-js"},"authClient.token.getWithoutPrompt({\n  responseType: ['id_token', 'access_token'], // or array of types\n})\n.then({tokens} => authClient.tokenManager.storeTokens(tokens))\n.catch(err => console.err);\n")),Object(a.b)("h2",{id:"discussion"},"Discussion"),Object(a.b)("p",null,"In practice, this approach will generally be used for applications with an SSO requirements. For some applications that just need updated JWTs, they can most likely leverage a short-lived, continually ",Object(a.b)("a",{parentName:"p",href:"https://developer.okta.com/docs/guides/refresh-tokens/refresh-token-rotation/"},"rotated ",Object(a.b)("inlineCode",{parentName:"a"},"refresh token")),"."),Object(a.b)("h3",{id:"related-links"},"Related Links"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",{parentName:"li",href:"https://support.okta.com/help/s/article/FAQ-How-Blocking-Third-Party-Cookies-Can-Potentially-Impact-Your-Okta-Environment?language=en_US"},"FAQ: How Blocked Third Party Cookies Can Potentially Impact Your Okta Environment")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",{parentName:"li",href:"https://devforum.okta.com/t/by-what-date-should-we-implement-refresh-token-rotation/15035/7"},"Dev Forum: By what date should we implement refresh token rotation")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",{parentName:"li",href:"https://devforum.okta.com/t/getting-a-fresh-jwt-on-demand/14686"},"Dev Forum: Getting a fresh JWT token"))))}p.isMDXComponent=!0},90:function(e,t,n){"use strict";n.d(t,"a",(function(){return d})),n.d(t,"b",(function(){return m}));var o=n(0),r=n.n(o);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=r.a.createContext({}),p=function(e){var t=r.a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},d=function(e){var t=p(e.components);return r.a.createElement(c.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},b=r.a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,i=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=p(n),b=o,m=d["".concat(i,".").concat(b)]||d[b]||u[b]||a;return n?r.a.createElement(m,s(s({ref:t},c),{},{components:n})):r.a.createElement(m,s({ref:t},c))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,i=new Array(a);i[0]=b;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,i[1]=s;for(var c=2;c<a;c++)i[c]=n[c];return r.a.createElement.apply(null,i)}return r.a.createElement.apply(null,n)}b.displayName="MDXCreateElement"}}]);