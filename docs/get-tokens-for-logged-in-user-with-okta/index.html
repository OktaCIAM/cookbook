<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="CIAM Cookbook Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="CIAM Cookbook Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-195353978-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><title data-react-helmet="true">Get Tokens for Logged in User | CIAM Cookbook</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Get Tokens for Logged in User | CIAM Cookbook"><meta data-react-helmet="true" name="description" content="How to get tokens with an already logged in user through Okta."><meta data-react-helmet="true" property="og:description" content="How to get tokens with an already logged in user through Okta."><meta data-react-helmet="true" name="keywords" content="Okta CIAM,Okta Access Tokens,Okta Session Management,Okta Token Management,Session Token Exchange,Session Already Exists,SSO Okta"><meta data-react-helmet="true" property="og:url" content="https://ciam.solutions//docs/get-tokens-for-logged-in-user-with-okta"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://ciam.solutions//docs/get-tokens-for-logged-in-user-with-okta"><link rel="stylesheet" href="/styles.bd8719a5.css">
<link rel="preload" href="/styles.0ae1fbdb.js" as="script">
<link rel="preload" href="/runtime~main.2ff9e65c.js" as="script">
<link rel="preload" href="/main.7c6339b2.js" as="script">
<link rel="preload" href="/1.e2761c67.js" as="script">
<link rel="preload" href="/2.5b466c94.js" as="script">
<link rel="preload" href="/22.07f6b87d.js" as="script">
<link rel="preload" href="/23.410bc457.js" as="script">
<link rel="preload" href="/935f2afb.e4e19c8b.js" as="script">
<link rel="preload" href="/17896441.07908ae5.js" as="script">
<link rel="preload" href="/32706c1c.234fd079.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img src="/img/cookbook-logo.png" alt="CIAM Image" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/cookbook-logo.png" alt="CIAM Image" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">CIAM Cookbook</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/OktaCIAM/cookbook" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">üåú</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">üåû</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/cookbook-logo.png" alt="CIAM Image" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/cookbook-logo.png" alt="CIAM Image" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">CIAM Cookbook</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/">Docs</a></li><li class="menu__list-item"><a href="https://github.com/OktaCIAM/cookbook" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/">Introduction</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Account Management</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/redirect-post-account-operations">Redirect Post Account Operations</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Sign In</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/alternative-username">Alternative Username</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/auto-send-sms-code">Auto Send SMS Code</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/initialize-idp-discovery">Initialize IdP Discovery</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/logo-per-app-context">Logo Based on App Context</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">reCAPTCHA</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/repcaptcha-v2">reCAPTCHA v2</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/repcaptcha-v3">reCAPTCHA v3</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Reporting</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/get-current-monthly-active-users">Get Current MAUs</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Sessions</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/max-session-timeout">Max Session Timeout</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Tokens</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/intercept-external-idp-tokens">External IdP Tokens</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/get-tokens-for-logged-in-user-with-okta">Get Tokens for Logged In User</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Hooks</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pass-state-data-to-token-hooks">Passing State Data to Token Hooks</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Get Tokens for Logged in User</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="problem"></a>Problem<a class="hash-link" href="#problem" title="Direct link to heading">#</a></h2><p>The user may already have an existing session with Okta (through another application or dashboard), however, your application may not have references to the oAuth/OIDC tokens OR the <a href="https://devforum.okta.com/t/getting-a-fresh-jwt-on-demand/14686" target="_blank" rel="noopener noreferrer">token&#x27;s claim do not reflect recently updated attributes</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="solution"></a>Solution<a class="hash-link" href="#solution" title="Direct link to heading">#</a></h2><p>Okta provides the ability to <a href="https://developer.okta.com/docs/reference/api/oidc/#parameter-details" target="_blank" rel="noopener noreferrer">silently authenticate an existing user</a> during a browser-based OpenID Connect flow with the <code>prompt</code> parameter set to <code>none</code>.</p><p>The steps are as followed:</p><ol><li><em>Recommended (Same Domains): <a href="https://developer.okta.com/docs/reference/api/sessions/#get-current-session" target="_blank" rel="noopener noreferrer">Validate Existing Session</a></em></li><li>Perform PKCE OAuth flow by redirecting user to your tenant&#x27;s <a href="https://developer.okta.com/docs/reference/api/oidc/#authorize" target="_blank" rel="noopener noreferrer"><code>/authorize</code> endpoint</a> with <code>prompt=none</code> with a <code>response_mode=query</code></li><li>Parse code from the <code>callback</code> redirect and exchange code for tokens</li><li>Store new tokens in the application</li></ol><p>Note, the redirect can create a jaggered user experience, but this can be improved upon with the use of an hidden iFrame. However, there is an important caveat one must consider prior to going with this approach:</p><blockquote><p>‚ö†Ô∏è  Cross-site origin iFrames are loaded in a third-party context. As a result, some browsers -- and eventually all -- block third-party cookies by default, therefore, this solution will not work for some environments. For more details, please refer to the <a href="https://support.okta.com/help/s/article/FAQ-How-Blocking-Third-Party-Cookies-Can-Potentially-Impact-Your-Okta-Environment?language=en_US" target="_blank" rel="noopener noreferrer">support page</a>.</p></blockquote><p>If this caveat doesn&#x27;t apply to your environment, the <code>okta-auth-js</code> SDK provides a method, <code>token.getWithoutPrompt(options)</code>, all within a hidden iFrame.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-js codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">authClient</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">token</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">getWithoutPrompt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  responseType</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;id_token&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;access_token&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// or array of types</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">then</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">tokens</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> authClient</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">tokenManager</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">storeTokens</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">tokens</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword control-flow" style="font-style:italic">catch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">err</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token console class-name" style="color:rgb(255, 203, 107)">console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">err</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="discussion"></a>Discussion<a class="hash-link" href="#discussion" title="Direct link to heading">#</a></h2><p>In practice, this approach will generally be used for applications with an SSO requirements. For some applications that just need updated JWTs, they can most likely leverage a short-lived, continually <a href="https://developer.okta.com/docs/guides/refresh-tokens/refresh-token-rotation/" target="_blank" rel="noopener noreferrer">rotated <code>refresh token</code></a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="related-links"></a>Related Links<a class="hash-link" href="#related-links" title="Direct link to heading">#</a></h3><ul><li><a href="https://support.okta.com/help/s/article/FAQ-How-Blocking-Third-Party-Cookies-Can-Potentially-Impact-Your-Okta-Environment?language=en_US" target="_blank" rel="noopener noreferrer">FAQ: How Blocked Third Party Cookies Can Potentially Impact Your Okta Environment</a></li><li><a href="https://devforum.okta.com/t/by-what-date-should-we-implement-refresh-token-rotation/15035/7" target="_blank" rel="noopener noreferrer">Dev Forum: By what date should we implement refresh token rotation</a></li><li><a href="https://devforum.okta.com/t/getting-a-fresh-jwt-on-demand/14686" target="_blank" rel="noopener noreferrer">Dev Forum: Getting a fresh JWT token</a></li></ul></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/master/website/docs/tokens/get-tokens-with-logged-in-user.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/intercept-external-idp-tokens"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">¬´ Intercept External IdP Tokens</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/pass-state-data-to-token-hooks"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Pass State Data to Token Inline Hooks ¬ª</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#problem" class="table-of-contents__link">Problem</a></li><li><a href="#solution" class="table-of-contents__link">Solution</a></li><li><a href="#discussion" class="table-of-contents__link">Discussion</a><ul><li><a href="#related-links" class="table-of-contents__link">Related Links</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Related</h4><ul class="footer__items"><li class="footer__item"><a href="https://developer.okta.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Okta Developer Documentation</a></li><li class="footer__item"><a href="https://devforum.okta.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Okta Developer Support Forum</a></li><li class="footer__item"><a href="https://docs.idp.rocks/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Okta Multi Tenant Admin</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/OktaCIAM" target="_blank" rel="noopener noreferrer" class="footer__link-item">CIAM Community</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://okta.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Okta</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2022 Okta CIAM Community. Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.0ae1fbdb.js"></script>
<script src="/runtime~main.2ff9e65c.js"></script>
<script src="/main.7c6339b2.js"></script>
<script src="/1.e2761c67.js"></script>
<script src="/2.5b466c94.js"></script>
<script src="/22.07f6b87d.js"></script>
<script src="/23.410bc457.js"></script>
<script src="/935f2afb.e4e19c8b.js"></script>
<script src="/17896441.07908ae5.js"></script>
<script src="/32706c1c.234fd079.js"></script>
</body>
</html>