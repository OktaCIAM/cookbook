<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="CIAM Cookbook Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="CIAM Cookbook Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-195353978-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><title data-react-helmet="true">Intercept External IdP Tokens | CIAM Cookbook</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Intercept External IdP Tokens | CIAM Cookbook"><meta data-react-helmet="true" name="description" content="Intercept external IdP tokens during okta inbound federation / social authentication"><meta data-react-helmet="true" property="og:description" content="Intercept external IdP tokens during okta inbound federation / social authentication"><meta data-react-helmet="true" name="keywords" content="Okta CIAM,External IdP Tokens,External IdP refresh tokens,Social authentication,Okta external IdP,Okta inbound federation"><meta data-react-helmet="true" property="og:url" content="https://ciam.solutions//docs/intercept-external-idp-tokens"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://ciam.solutions//docs/intercept-external-idp-tokens"><link rel="stylesheet" href="/styles.bd8719a5.css">
<link rel="preload" href="/styles.0ae1fbdb.js" as="script">
<link rel="preload" href="/runtime~main.f0a90a52.js" as="script">
<link rel="preload" href="/main.866e693e.js" as="script">
<link rel="preload" href="/1.e2761c67.js" as="script">
<link rel="preload" href="/2.5b466c94.js" as="script">
<link rel="preload" href="/22.07f6b87d.js" as="script">
<link rel="preload" href="/23.410bc457.js" as="script">
<link rel="preload" href="/935f2afb.7255abca.js" as="script">
<link rel="preload" href="/17896441.07908ae5.js" as="script">
<link rel="preload" href="/1f592722.09cf6b94.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img src="/img/cookbook-logo.png" alt="CIAM Image" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/cookbook-logo.png" alt="CIAM Image" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">CIAM Cookbook</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/OktaCIAM/cookbook" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/cookbook-logo.png" alt="CIAM Image" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/cookbook-logo.png" alt="CIAM Image" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">CIAM Cookbook</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/">Docs</a></li><li class="menu__list-item"><a href="https://github.com/OktaCIAM/cookbook" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/">Introduction</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Account Management</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/redirect-post-account-operations">Redirect Post Account Operations</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Sign In</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/alternative-username">Alternative Username</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/auto-send-sms-code">Auto Send SMS Code</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/initialize-idp-discovery">Initialize IdP Discovery</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/logo-per-app-context">Logo Based on App Context</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/hide-connect-banner">Hide Connect Banner</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">reCAPTCHA (Classic)</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/repcaptcha-v2">reCAPTCHA v2</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/repcaptcha-v3">reCAPTCHA v3</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Reporting</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/get-current-monthly-active-users">Get Current MAUs</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Sessions</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/max-session-timeout">Max Session Timeout</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Tokens</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/intercept-external-idp-tokens">External IdP Tokens</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/get-tokens-for-logged-in-user-with-okta">Get Tokens for Logged In User</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Hooks</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pass-state-data-to-token-hooks">Passing State Data to Token Hooks</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Intercept External IdP Tokens</h1></header><div class="markdown"><blockquote><p><strong>Disclaimer</strong>
Please note, this is <strong>NOT</strong> officially supported by Okta and only serves as a high-level guidance for a creating a workaround. At any time, this workaround can change or stop functioning.</p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="problem"></a>Problem<a class="hash-link" href="#problem" title="Direct link to heading">#</a></h2><blockquote><p><strong>Note:</strong> If an access token is sufficient enough, you may use this <a href="https://developer.okta.com/docs/reference/api/idps/#social-authentication-token-operation" target="_blank" rel="noopener noreferrer">API</a>s</p></blockquote><p>In unique circumstances (B2B), an application may need to intercept the <code>ID Token</code> or <code>Refresh Token</code> from the external or social authenticated IdP.</p><p>Typical scenarios include:</p><ul><li>Proof of access against the parent identity provider where re-authentication is not sufficient enough</li><li>Utilizing the ID token for custom inline hooks logic</li><li>Uncertain security practices around external refresh tokens (lack of rotations or indefinite lifetimes)</li></ul><p>Alternatively, a trusted application can perform multiple oauth flows with differently scoped integrations within the client-side.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="solution"></a>Solution<a class="hash-link" href="#solution" title="Direct link to heading">#</a></h2><p>This requires a proxy in-between the <code>token</code> endpoint to intercept the tokens.</p><p><img src="https://user-images.githubusercontent.com/6020066/123849790-3600d000-d8e7-11eb-9023-44a17aba60ff.png" alt="Dashboard Location"></p><p>This proxy will serve as a token interceptor where Okta will send the authorization code in exchange for a token. Within the transaction, the proxy will relay the request to the actual external IdP token endpoint and store the tokens while sending them back to Okta. Afterwards, internal services can utilize the data store for additional token operations. Refer to <em>figure 1</em> below for a high-level diagram.</p><p><strong>Figure 1: High-Level Diagram</strong>
<img src="https://user-images.githubusercontent.com/6020066/123849258-96434200-d8e6-11eb-9134-fd0ffd8ad62c.jpeg" alt="External IdP Tokens Diagram"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="discussion"></a>Discussion<a class="hash-link" href="#discussion" title="Direct link to heading">#</a></h2><p>In practice, it you&#x27;ll come across some nuances to properly relay and hand-off the tokens. Feel free to add some issues you may come across onto this document.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/master/website/docs/tokens/external-idp-tokens.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/max-session-timeout"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Max Session Timeout</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/get-tokens-for-logged-in-user-with-okta"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Get Tokens for Logged in User Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#problem" class="table-of-contents__link">Problem</a></li><li><a href="#solution" class="table-of-contents__link">Solution</a></li><li><a href="#discussion" class="table-of-contents__link">Discussion</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Related</h4><ul class="footer__items"><li class="footer__item"><a href="https://developer.okta.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Okta Developer Documentation</a></li><li class="footer__item"><a href="https://devforum.okta.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Okta Developer Support Forum</a></li><li class="footer__item"><a href="https://docs.idp.rocks/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Okta Multi Tenant Admin</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/OktaCIAM" target="_blank" rel="noopener noreferrer" class="footer__link-item">CIAM Community</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://okta.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Okta</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 Okta CIAM Community. Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.0ae1fbdb.js"></script>
<script src="/runtime~main.f0a90a52.js"></script>
<script src="/main.866e693e.js"></script>
<script src="/1.e2761c67.js"></script>
<script src="/2.5b466c94.js"></script>
<script src="/22.07f6b87d.js"></script>
<script src="/23.410bc457.js"></script>
<script src="/935f2afb.7255abca.js"></script>
<script src="/17896441.07908ae5.js"></script>
<script src="/1f592722.09cf6b94.js"></script>
</body>
</html>