(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{83:function(e,t,o){"use strict";o.r(t),o.d(t,"frontMatter",(function(){return i})),o.d(t,"metadata",(function(){return s})),o.d(t,"toc",(function(){return l})),o.d(t,"default",(function(){return p}));var a=o(3),n=o(7),r=(o(0),o(92)),i={id:"pass-state-data-to-token-hooks",title:"Pass State Data to Token Inline Hooks",sidebar_label:"Passing State Data to Token Hooks",slug:"/pass-state-data-to-token-hooks",description:"This recipe is a simple way to pass along data that may only co-exist on the application side, but is needed for additional context in the inline hook.",keywords:["Okta CIAM","Okta Webhooks","Okta Token Inline Hooks"]},s={unversionedId:"hooks/pass-state-data-to-token-hooks",id:"hooks/pass-state-data-to-token-hooks",isDocsHomePage:!1,title:"Pass State Data to Token Inline Hooks",description:"This recipe is a simple way to pass along data that may only co-exist on the application side, but is needed for additional context in the inline hook.",source:"@site/docs/hooks/pass-state-data-to-token-hooks.md",slug:"/pass-state-data-to-token-hooks",permalink:"/docs/pass-state-data-to-token-hooks",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/hooks/pass-state-data-to-token-hooks.md",version:"current",sidebar_label:"Passing State Data to Token Hooks",sidebar:"docs",previous:{title:"Get Tokens for Logged in User",permalink:"/docs/get-tokens-for-logged-in-user-with-okta"}},l=[{value:"Problem",id:"problem",children:[]},{value:"Solution",id:"solution",children:[{value:"Authorization Code Flow",id:"authorization-code-flow",children:[]},{value:"Client Credential Flow",id:"client-credential-flow",children:[]}]},{value:"Discussion",id:"discussion",children:[]},{value:"Credits",id:"credits",children:[]}],c={toc:l};function p(e){var t=e.components,o=Object(n.a)(e,["components"]);return Object(r.b)("wrapper",Object(a.a)({},c,o,{components:t,mdxType:"MDXLayout"}),Object(r.b)("h2",{id:"problem"},"Problem"),Object(r.b)("p",null,"The token inline hook sends a request that is defined by context that exists around the end-user and the client. However, there are few cases where the application holds state data that may need to be passed to the hook service."),Object(r.b)("h2",{id:"solution"},"Solution"),Object(r.b)("h3",{id:"authorization-code-flow"},"Authorization Code Flow"),Object(r.b)("p",null,"When making an authorization request with a ",Object(r.b)("inlineCode",{parentName:"p"},"authorization code")," flow, you can pass along a ",Object(r.b)("inlineCode",{parentName:"p"},"state")," query parameter in the ",Object(r.b)("inlineCode",{parentName:"p"},"/authorize")," url. This state will be available in ",Object(r.b)("inlineCode",{parentName:"p"},"data.context.protocol.request.state"),"."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-js"},'    "protocol": {\n        "type": "OAUTH2.0",\n        "request": {\n            "state": "foobareere",\n        }\n    }\n')),Object(r.b)("p",null,"More Information: ",Object(r.b)("a",{parentName:"p",href:"https://developer.okta.com/docs/reference/api/oidc/#request-parameters"},"https://developer.okta.com/docs/reference/api/oidc/#request-parameters")),Object(r.b)("h3",{id:"client-credential-flow"},"Client Credential Flow"),Object(r.b)("p",null,"With a client credential flow, there is not state parameter available. However, the ",Object(r.b)("inlineCode",{parentName:"p"},"/token")," url that triggered the hook will be passed along in the request payload. Thus, by appending additional query parameters to the token request, these parameters will be available in the webhook to be parsed."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-js"},'{\n    // ... omitted\n    "data": {\n        "context": {\n        "request": {\n            "id": "reqv66CbCaCStGEFc8AdfS0ng",\n            "method": "GET",\n            "url": {\n                "value": "https://${yourOktaDomain}/oauth2/default/v1/token?scope=openid+profile+email&response_type=token&myStateParameter=hello+world"\n            },\n            "ipAddress": "127.0.0.1"\n        },\n    // ... omitted\n')),Object(r.b)("p",null,"In this instance, we can reference the url through ",Object(r.b)("inlineCode",{parentName:"p"},"data.context.request.url.value")," and use code to parse the ",Object(r.b)("inlineCode",{parentName:"p"},"myStateParameter")," in the url and derive the value (hello+world)."),Object(r.b)("p",null,"A simple example to parse the ",Object(r.b)("inlineCode",{parentName:"p"},"myStateParameter")," in Javascript would look like such:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-js"},'const url = "https://foo.okta.com/oauth2/default/v1/token?scope=openid+profile+email&response_type=token&myStateParameter=hello+world";\nconst regex = /(?<=myStateParameter=).+(?=&|$)/i\nconst stateParamValue = url.match(regex)[0]; // hello+world\n\nif (stateParamValue) {\n  // Do Something with State Param Value\n}\n')),Object(r.b)("h2",{id:"discussion"},"Discussion"),Object(r.b)("p",null,"It's important to avoid passing along sensitive data through the request parameters, despite being encrypted through HTTPS, these url are logged in the Okta system log. Thus, if you need to pass along sensitive data, it's best to query behind your service / back channel."),Object(r.b)("h2",{id:"credits"},"Credits"),Object(r.b)("p",null,"Credits to ",Object(r.b)("a",{parentName:"p",href:"https://github.com/brh55"},"Brandon Him")," for the initial recipe."),Object(r.b)("p",null,"Feel free to contribute support for other languages by ",Object(r.b)("a",{parentName:"p",href:"https://github.com/OktaCIAM/cookbook/pulls"},"submitting a PR"),"."))}p.isMDXComponent=!0},92:function(e,t,o){"use strict";o.d(t,"a",(function(){return d})),o.d(t,"b",(function(){return h}));var a=o(0),n=o.n(a);function r(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function i(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}function s(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?i(Object(o),!0).forEach((function(t){r(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):i(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function l(e,t){if(null==e)return{};var o,a,n=function(e,t){if(null==e)return{};var o,a,n={},r=Object.keys(e);for(a=0;a<r.length;a++)o=r[a],t.indexOf(o)>=0||(n[o]=e[o]);return n}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)o=r[a],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}var c=n.a.createContext({}),p=function(e){var t=n.a.useContext(c),o=t;return e&&(o="function"==typeof e?e(t):s(s({},t),e)),o},d=function(e){var t=p(e.components);return n.a.createElement(c.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.a.createElement(n.a.Fragment,{},t)}},b=n.a.forwardRef((function(e,t){var o=e.components,a=e.mdxType,r=e.originalType,i=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=p(o),b=a,h=d["".concat(i,".").concat(b)]||d[b]||u[b]||r;return o?n.a.createElement(h,s(s({ref:t},c),{},{components:o})):n.a.createElement(h,s({ref:t},c))}));function h(e,t){var o=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=o.length,i=new Array(r);i[0]=b;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var c=2;c<r;c++)i[c]=o[c];return n.a.createElement.apply(null,i)}return n.a.createElement.apply(null,o)}b.displayName="MDXCreateElement"}}]);